<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      xmlns:nc="http://typo3.org/ns/NC/NcProviderMain/ViewHelpers"
      xmlns:e="http://typo3.org/ns/DERHANSEN/SfEventMgt/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:layout name="Default"/>
<f:section name="main">

  <f:if condition="{event}">
    <nc:titleTag>
      <f:format.htmlentitiesDecode>Anmeldung zur Veranstaltung {event.title}</f:format.htmlentitiesDecode>
    </nc:titleTag>

    <div class="u-container u-my-fluid-3xl">
      <div class="u-limitWidth-12 u-align-center u-stack-xl">
        <h1>
          <f:format.htmlentitiesDecode><span class="Text-heading-4xl">Anmeldung zur Veranstaltung</span><br><span class="Text-heading-3xl">{event.title}</span></f:format.htmlentitiesDecode>
        </h1>

        <div id="maincontent" class="GridCol2MainAside-row u-row">
          <div class="GridCol2MainAside-colAside u-col">

            <div class="u-stack-lg u-bg-accent u-pa-md">

              <f:render partial="EventFacts" section="Default" arguments="{event:event}"/>

            </div>
          </div>
          <div class="GridCol2MainAside-colMain GridCol2MainAside--colOrderLeft u-col">
            <div class="u-stack-md">

              <f:if condition="{event.registrationPossible}">
                <f:then>

                  <f:if condition="{event.enableWaitlist}">
                    <f:if condition="{event.registrations->f:count()} >= {event.maxParticipants}">
                      <p class="Text-body">
                        <strong>
                          Bitte beachten Sie, dass die Veranstaltung ausgebucht ist und Sie sich auf der Warteliste registrieren
                        </strong>
                      </p>
                    </f:if>
                  </f:if>

                  <f:form object="{registration}" name="registration" action="saveRegistration" arguments="{event: event}" enctype="multipart/form-data">

                    <f:render partial="Registration/SpamCheck" arguments="{spamSettings: settings.registration.spamCheck, event: event}"/>

                    <div class="u-stack-lg">

                      <fieldset class="u-stack-md">

                        <div class="GridCol2Even-row u-row">
                          <div class="GridCol2Even-col u-col">
                            <div class="FormField {e:validation.errorClass(fieldname: 'firstname')}">
                              <label class="FormField-label" for="firstname">
                                <f:translate key="tx_sfeventmgt_domain_model_registration.firstname"/>
                                <e:registration.isRequiredField settings="{settings}" fieldname="firstname">
                                  <span class="mandatory">(Pflichtfeld)</span>
                                </e:registration.isRequiredField>
                              </label>
                              <div class="FormField-input">
                                <f:form.textfield class="TextField" id="firstname" property="firstname" value="{e:prefill(fieldname: 'firstname', prefillSettings: '{settings.registration.prefillFields}')}" required="required"
                                                  additionalAttributes="{aria-describedby:'field-errors-registration.firstname', autocomplete:'given-name'}"/>
                              </div>
                              <f:render partial="FormErrors" arguments="{field: 'registration.firstname'}"/>
                            </div>
                          </div>
                          <div class="GridCol2Even-col u-col">
                            <div class="FormField {e:validation.errorClass(fieldname: 'lastname')}">
                              <label class="FormField-label" for="lastname">
                                <f:translate key="tx_sfeventmgt_domain_model_registration.lastname"/>
                                <e:registration.isRequiredField settings="{settings}" fieldname="lastname">
                                  <span class="mandatory">(Pflichtfeld)</span>
                                </e:registration.isRequiredField>
                              </label>
                              <div class="FormField-input">
                                <f:form.textfield class="TextField" id="lastname" property="lastname" value="{e:prefill(fieldname: 'lastname', prefillSettings: '{settings.registration.prefillFields}')}" required="required"
                                                  additionalAttributes="{aria-describedby:'field-errors-registration.lastname', autocomplete:'family-name'}"/>
                              </div>
                              <f:render partial="FormErrors" arguments="{field: 'registration.lastname'}"/>
                            </div>
                          </div>
                        </div>

                        <div class="FormField {e:validation.errorClass(fieldname: 'email')}">
                          <label class="FormField-label" for="email">
                            E-Mail-Adresse
                            <e:registration.isRequiredField settings="{settings}" fieldname="email">
                              <span class="mandatory">(Pflichtfeld)</span>
                            </e:registration.isRequiredField>
                          </label>
                          <div class="FormField-input">
                            <f:form.textfield class="TextField" id="email" property="email" value="{e:prefill(fieldname: 'email', prefillSettings: '{settings.registration.prefillFields}')}" required="required" type="email"
                                              additionalAttributes="{aria-describedby:'field-errors-registration.email', autocomplete:'email'}"/>
                          </div>
                          <f:render partial="FormErrors" arguments="{field: 'registration.email'}"/>
                        </div>

                        <div class="FormField {e:validation.errorClass(fieldname: 'company')}">
                          <label class="FormField-label" for="company">
                            Institution
                            <e:registration.isRequiredField settings="{settings}" fieldname="company">
                              <span class="mandatory">(Pflichtfeld)</span>
                            </e:registration.isRequiredField>
                          </label>
                          <div class="FormField-input">
                            <f:form.textfield class="TextField" id="company" property="company" value="{e:prefill(fieldname: 'company', prefillSettings: '{settings.registration.prefillFields}')}"/>
                          </div>
                          <f:render partial="FormErrors" arguments="{field: 'registration.company'}"/>
                        </div>

                        <f:if condition="{event.maxRegistrationsPerUser} > 1">
                          <div class="FormField">
                            <label class="FormField-label" for="amountOfRegistrations">
                              <f:translate key="tx_sfeventmgt_domain_model_registration.amountOfRegistrations"/>
                            </label>
                            <div class="FormField-input">
                              <div class="Select">
                                <f:form.select id="amountOfRegistrations" property="amountOfRegistrations" options="{e:event.simultaneousRegistrations(event: '{event}')}"/>
                              </div>
                            </div>
                          </div>
                        </f:if>

                        <div class="FormField {e:validation.errorClass(fieldname: 'notes')}">
                          <label for="FormField-label">
                            Nachricht
                            <e:registration.isRequiredField settings="{settings}" fieldname="notes">
                              <span class="event-required">(Pflichfeld)</span>
                            </e:registration.isRequiredField>
                          </label>
                          <div class="FormField-input">
                            <f:form.textarea class="TextField" id="notes" property="notes"/>
                          </div>
                          <f:render partial="FormErrors" arguments="{field: 'registration.notes'}"/>
                        </div>

                        <f:if condition="{event.registrationFields}">
                          <f:for each="{event.registrationFields}" as="field">
                            <f:render partial="Registration/Fields/{field.partialName}" arguments="{field: field}"/>
                          </f:for>
                        </f:if>

                      </fieldset>

                      <div class="u-stack-md">


                        <fieldset class="FormField">

                          <legend class="u-visuallyHidden">Einwilligung Aufzeichnung</legend>

                          <div class="FormField-input">
                            <div class="FormField-choice {e:validation.errorClass(fieldname: 'acceptrecording')}">
                              <f:form.checkbox class="Checkbox" id="acceptrecording" property="acceptrecording" value="1" additionalAttributes="{aria-describedby:'field-errors-registration.acceptrecording', required:'required'}"/>
                              <label class="FormField-choiceLabel" for="acceptrecording">
                                Erlaubnis / Hinweis Aufzeichnung (Foto,Film) und <f:link.page class="Link" pageUid="6" target="_blank">Datenschutz</f:link.page>
                                <e:registration.isRequiredField settings="{settings}" fieldname="acceptrecording">
                                  <span class="mandatory">(Pflichtfeld)</span>
                                </e:registration.isRequiredField>
                              </label>
                            </div>
                            <f:render partial="FormErrors" arguments="{field: 'registration.acceptrecording'}"/>
                          </div>
                        </fieldset>

                        <fieldset class="FormField">

                          <legend class="u-visuallyHidden">Einwilligung Unterlagenversand</legend>

                          <div class="FormField-input">
                            <div class="FormField-choice {e:validation.errorClass(fieldname: 'acceptdocuments')}">
                              <f:form.checkbox class="Checkbox" id="acceptdocuments" property="acceptdocuments" value="1" additionalAttributes="{aria-describedby:'field-errors-registration.acceptdocuments', required:'required'}"/>
                              <label class="FormField-choiceLabel" for="acceptdocuments">
                                Kontakterlaubnis zum Unterlagenversand.
                                <e:registration.isRequiredField settings="{settings}" fieldname="acceptdocuments">
                                  <span class="mandatory">(Pflichtfeld)</span>
                                </e:registration.isRequiredField>
                              </label>
                            </div>
                            <f:render partial="FormErrors" arguments="{field: 'registration.acceptdocuments'}"/>
                          </div>
                        </fieldset>


                        <fieldset class="FormField">

                          <legend class="u-visuallyHidden">Datenaustausch an andere Teilnehmer*innen</legend>

                          <div class="FormField-input">
                            <div class="FormField-choice {e:validation.errorClass(fieldname: 'acceptexchange')}">
                              <f:form.checkbox class="Checkbox" id="acceptexchange" property="acceptexchange" value="1" additionalAttributes="{aria-describedby:'field-errors-registration.acceptexchange'}"/>
                              <label class="FormField-choiceLabel" for="acceptexchange">
                                Ich bin damit einverstanden, dass meine Daten zwecks Austausch an alle Teilnehmer*innen der Veranstaltung weitergegeben werden.
                                <e:registration.isRequiredField settings="{settings}" fieldname="acceptexchange">
                                  <span class="mandatory">(Pflichtfeld)</span>
                                </e:registration.isRequiredField>
                              </label>
                            </div>
                            <f:render partial="FormErrors" arguments="{field: 'registration.acceptexchange'}"/>
                          </div>
                        </fieldset>


                        <fieldset class="FormField">

                          <legend class="u-visuallyHidden">Einwilligung AGB</legend>

                          <div class="FormField-input">
                            <div class="FormField-choice {e:validation.errorClass(fieldname: 'accepttc')}">
                              <f:form.checkbox class="Checkbox" id="accepttc" property="accepttc" value="1" additionalAttributes="{aria-describedby:'field-errors-registration.accepttc', required:'required'}"/>
                              <label class="FormField-choiceLabel" for="accepttc">
                                Ich bin mit den <f:link.page class="Link" pageUid="7" target="_blank">allgemeinen Geschäftsbedingungen (AGB)</f:link.page> einverstanden.
                                <e:registration.isRequiredField settings="{settings}" fieldname="accepttc">
                                  <span class="mandatory">(Pflichtfeld)</span>
                                </e:registration.isRequiredField>
                              </label>
                            </div>
                            <f:render partial="FormErrors" arguments="{field: 'registration.accepttc'}"/>
                          </div>
                        </fieldset>

                      </div>

                      <fieldset class="u-stack-md">
                        <div class="u-textAlign--right">
                          <f:form.submit value="Verbindlich anmelden" class="Button"/>
                        </div>
                      </fieldset>
                    </div>

                  </f:form>

                </f:then>
                <f:else>

                  <p class="Text-body">Die Anmeldung ist nicht möglich – eventuelle Gründe: Veranstaltung abgelaufen, Anmeldefrist oder max. Teilnehmer erreicht.</p>

                </f:else>
              </f:if>

              <div class="Text-body">
                <f:link.action class="Link" action="detail" pageUid="{settings.detailPid}" arguments="{event: event}"><span class="Link-icon"><f:render partial="Base/Symbols" section="Symbol" arguments="{name:'arrow-left'}"/></span>Zurück zur Veranstaltung</f:link.action>
              </div>


            </div>
          </div>
        </div>

      </div>

    </div>


  </f:if>

</f:section>
